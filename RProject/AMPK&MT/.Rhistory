cluster_rows = T,
show_colnames = F,
show_rownames = T,
border_color = NA,
scale = 'row')
diff = DEG[DEG$change !="NOT",]
up <- diff %>% top_n(25,logFC)
diff = DEG[DEG$change !="NOT",]
up <- diff %>% top_n(25,log2FoldChange)
dw <- diff %>% top_n(-25,log2FoldChange)
all <-c(rownames(up),rownames(dw))
exp_diff2<- exp[all,]
pheatmap(exp_diff2,
annotation_col=rt,
color = colorRampPalette((c("blue","white","red")))(100),
cluster_cols = F,
cluster_rows = T,
show_colnames = F,
show_rownames = T,
border_color = NA,
scale = 'row')
View(DEG)
table(DEG$change)
View(exp_diff)
View(exp_diff)
View(exp_diff2)
BiocManager::install('biomaRt')
library(biomaRt)
library(biomaRt)
mart <- useEnsembl(biomart = "genes",dataset = "cporcellus_gene_ensembl")
map <- getBM(
attributes = c(
"external_gene_name",   # gene symbol
"entrezgene_id"         # EntrezID
),
filters = "external_gene_name",
values = gene_symbols,    # 你的symbol向量
mart = mart
)
map <- getBM(
attributes = c(
"gene_id",   # gene symbol
"ENTREZID"         # EntrezID
),
filters = "gene_id",
values = DEG,    # 你的symbol向量
mart = mart
)
map <- getBM(
attributes = c(
"external_gene_name",   # gene symbol
"entrezgene_id"         # EntrezID
),
filters = "external_gene_name",
values = DEG,    # 你的symbol向量
mart = mart
)
head(map)
View(DEG)
genelist <- row.names(DEG)
map <- getBM(
attributes = c(
"external_gene_name",   # gene symbol
"entrezgene_id"         # EntrezID
),
filters = "external_gene_name",
values = genelist,    # 你的symbol向量
mart = mart
)
View(map)
gene_entrez <- na.omit(unique(map$entrezgene_id))
View(diff)
View(DEG)
diff <- rownames (DEG) [DEG$change!='NOT']
mart <- useEnsembl(biomart = "genes",dataset = "cporcellus_gene_ensembl")
map <- getBM(
attributes = c(
"external_gene_name",   # gene symbol
"entrezgene_id"         # EntrezID
),
filters = "external_gene_name",
values = diff,    # 你的symbol向量
mart = mart
)
View(map)
gene_entrez <- na.omit(unique(map$entrezgene_id))
View(map)
View(map)
mart_cpo <- useEnsembl(biomart = "genes",dataset = "cporcellus_gene_ensembl")
mart_hsa <- useEnsembl(biomart = "genes",dataset = "hsapiens_gene_ensembl")
orth <- getLDS(
attributes  = c("external_gene_name"),         # 豚鼠 symbol
filters     = "external_gene_name",
values      = diff,
mart        = mart_cpo,
attributesL = c("entrezgene_id", "hgnc_symbol"),# 人类 ENTREZ + SYMBOL
martL       = mart_hsa
)
rlang::last_trace()
rlang::last_trace(drop = FALSE)
mart_cpo <- useEnsembl(biomart = "genes",dataset = "cporcellus_gene_ensembl",mirror = "asia")
mart_hsa <- useEnsembl(biomart = "genes",dataset = "hsapiens_gene_ensembl",mirror = "asia")
orth <- getLDS(
attributes  = c("external_gene_name"),         # 豚鼠 symbol
filters     = "external_gene_name",
values      = diff,
mart        = mart_cpo,
attributesL = c("entrezgene_id", "hgnc_symbol"),# 人类 ENTREZ + SYMBOL
martL       = mart_hsa
)
rlang::last_trace()
rlang::last_trace(drop = FALSE)
ds <- listDatasets(mart)
View(ds)
orth <- getLDS(
attributes  = c("external_gene_name"),         # 豚鼠 symbol
filters     = "external_gene_name",
values      = diff,
mart        = mart_cpo,
attributesL = c("entrezgene_id", "hgnc_symbol"),# 人类 ENTREZ + SYMBOL
martL       = mart_hsa
)
orth <- getLDS(
attributes  = c("external_gene_name"),         # 豚鼠 symbol
filters     = "external_gene_name",
values      = diff,
mart        = mart_cpo,
attributesL = c("entrezgene_id", "hgnc_symbol"),# 人类 ENTREZ + SYMBOL
martL       = mart_hsa
)
cpo_map <- getBM(
attributes = c("external_gene_name", "ensembl_gene_id"),
filters    = "external_gene_name",
values     = diff,
mart       = mart_cpo
)
attrs_cpo <- listAttributes(mart_cpo)$name
grep("hsapiens|ortholog", attrs_cpo, value=TRUE)[1:30]
orth1 <- getBM(
attributes = c(
"ensembl_gene_id",
"hsapiens_homolog_ensembl_gene",              # 关键：human ortholog Ensembl gene
"hsapiens_homolog_associated_gene_name",      # human symbol（可选）
"hsapiens_homolog_orthology_confidence"       # 置信度（可选）
),
filters = "ensembl_gene_id",
values  = unique(cpo_map$ensembl_gene_id),
mart    = mart_cpo
)
hsa_entrez <- getBM(
attributes = c("ensembl_gene_id", "entrezgene_id", "hgnc_symbol"),
filters    = "ensembl_gene_id",
values     = unique(orth1$hsapiens_homolog_ensembl_gene),
mart       = mart_hsa
)
# 合并
orth <- merge(orth1, cpo_map, by="ensembl_gene_id", all.x=TRUE)
orth <- merge(orth, hsa_entrez, by.x="hsapiens_homolog_ensembl_gene", by.y="ensembl_gene_id", all.x=TRUE)
# 结果：cpo_symbol -> human_symbol -> human_entrez
orth <- orth[, c("external_gene_name", "hsapiens_homolog_associated_gene_name", "hgnc_symbol", "entrezgene_id", "hsapiens_homolog_orthology_confidence")]
colnames(orth)[1] <- "cpo_symbol"
head(orth)
View(orth)
cpo_map <- getBM(
attributes = c("external_gene_name", "ensembl_gene_id"),
filters    = "external_gene_name",
values     = diff,
mart       = mart_cpo
)
attrs_cpo <- listAttributes(mart_cpo)$name
grep("hsapiens|ortholog", attrs_cpo, value=TRUE)[1:30]
orth1 <- getBM(
attributes = c(
"ensembl_gene_id",
"hsapiens_homolog_ensembl_gene",              # 关键：human ortholog Ensembl gene
"hsapiens_homolog_associated_gene_name",      # human symbol（可选））
),
filters = "ensembl_gene_id",
values  = unique(cpo_map$ensembl_gene_id),
mart    = mart_cpo
)
cpo_map <- getBM(
attributes = c("external_gene_name", "ensembl_gene_id"),
filters    = "external_gene_name",
values     = diff,
mart       = mart_cpo
)
attrs_cpo <- listAttributes(mart_cpo)$name
grep("hsapiens|ortholog", attrs_cpo, value=TRUE)[1:30]
orth1 <- getBM(
attributes = c(
"ensembl_gene_id",
"hsapiens_homolog_ensembl_gene",              # 关键：human ortholog Ensembl gene
"hsapiens_homolog_associated_gene_name",      # human symbol（可选））
),
filters = "ensembl_gene_id",
values  = unique(cpo_map$ensembl_gene_id),
mart    = mart_cpo
)
cpo_map <- getBM(
attributes = c("external_gene_name", "ensembl_gene_id"),
filters    = "external_gene_name",
values     = diff,
mart       = mart_cpo
)
attrs_cpo <- listAttributes(mart_cpo)$name
grep("hsapiens|ortholog", attrs_cpo, value=TRUE)[1:30]
orth1 <- getBM(
attributes = c(
"ensembl_gene_id",
"hsapiens_homolog_ensembl_gene",              # 关键：human ortholog Ensembl gene
"hsapiens_homolog_associated_gene_name",      # human symbol（可选））
),
filters = "ensembl_gene_id",
values  = unique(cpo_map$ensembl_gene_id),
mart    = mart_cpo
)
cpo_map <- getBM(
attributes = c("external_gene_name", "ensembl_gene_id"),
filters    = "external_gene_name",
values     = diff,
mart       = mart_cpo
)
attrs_cpo <- listAttributes(mart_cpo)$name
grep("hsapiens|ortholog", attrs_cpo, value=TRUE)[1:30]
orth1 <- getBM(
attributes = c(
"ensembl_gene_id",
"hsapiens_homolog_ensembl_gene",              # 关键：human ortholog Ensembl gene
"hsapiens_homolog_associated_gene_name"      # human symbol（可选））
),
filters = "ensembl_gene_id",
values  = unique(cpo_map$ensembl_gene_id),
mart    = mart_cpo
)
hsa_entrez <- getBM(
attributes = c("ensembl_gene_id", "entrezgene_id", "hgnc_symbol"),
filters    = "ensembl_gene_id",
values     = unique(orth1$hsapiens_homolog_ensembl_gene),
mart       = mart_hsa
)
# 合并
orth <- merge(orth1, cpo_map, by="ensembl_gene_id", all.x=TRUE)
orth <- merge(orth, hsa_entrez, by.x="hsapiens_homolog_ensembl_gene", by.y="ensembl_gene_id", all.x=TRUE)
# 结果：cpo_symbol -> human_symbol -> human_entrez
orth <- orth[, c("external_gene_name", "hsapiens_homolog_associated_gene_name", "hgnc_symbol", "entrezgene_id")]
colnames(orth)[1] <- "cpo_symbol"
head(orth)
colnames(orth) <- c("cpo_symbol", "hsa_entrez", "hsa_symbol")
orth <- orth[!is.na(orth$hsa_entrez) & orth$hsa_entrez != "", ]
head(orth)
View(orth)
View(orth)
cpo_map <- getBM(
attributes = c("external_gene_name", "ensembl_gene_id"),
filters    = "external_gene_name",
values     = diff,
mart       = mart_cpo
)
attrs_cpo <- listAttributes(mart_cpo)$name
grep("hsapiens|ortholog", attrs_cpo, value=TRUE)[1:30]
orth1 <- getBM(
attributes = c(
"ensembl_gene_id",
"hsapiens_homolog_ensembl_gene",              # 关键：human ortholog Ensembl gene
"hsapiens_homolog_associated_gene_name"      # human symbol（可选））
),
filters = "ensembl_gene_id",
values  = unique(cpo_map$ensembl_gene_id),
mart    = mart_cpo
)
hsa_entrez <- getBM(
attributes = c("ensembl_gene_id", "entrezgene_id", "hgnc_symbol"),
filters    = "ensembl_gene_id",
values     = unique(orth1$hsapiens_homolog_ensembl_gene),
mart       = mart_hsa
)
# 合并
orth <- merge(orth1, cpo_map, by="ensembl_gene_id", all.x=TRUE)
orth <- merge(orth, hsa_entrez, by.x="hsapiens_homolog_ensembl_gene", by.y="ensembl_gene_id", all.x=TRUE)
# 结果：cpo_symbol -> human_symbol -> human_entrez
orth <- orth[, c("external_gene_name", "hsapiens_homolog_associated_gene_name", "hgnc_symbol", "entrezgene_id")]
colnames(orth)[1] <- "cpo_symbol"
head(orth)
gene_entrez <- na.omit(orth)
View(gene_entrez)
colnames(gene_entrez) <- c("cpo_gene", "hsa_gene", "ENTREZID")
View(gene_entrez)
cpo_map <- getBM(
attributes = c("external_gene_name", "ensembl_gene_id"),
filters    = "external_gene_name",
values     = diff,
mart       = mart_cpo
)
attrs_cpo <- listAttributes(mart_cpo)$name
grep("hsapiens|ortholog", attrs_cpo, value=TRUE)[1:30]
orth1 <- getBM(
attributes = c(
"ensembl_gene_id",
"hsapiens_homolog_ensembl_gene",              # 关键：human ortholog Ensembl gene
"hsapiens_homolog_associated_gene_name"      # human symbol（可选））
),
filters = "ensembl_gene_id",
values  = unique(cpo_map$ensembl_gene_id),
mart    = mart_cpo
)
hsa_entrez <- getBM(
attributes = c("ensembl_gene_id", "entrezgene_id", "hgnc_symbol"),
filters    = "ensembl_gene_id",
values     = unique(orth1$hsapiens_homolog_ensembl_gene),
mart       = mart_hsa
)
# 合并
orth <- merge(orth1, cpo_map, by="ensembl_gene_id", all.x=TRUE)
orth <- merge(orth, hsa_entrez, by.x="hsapiens_homolog_ensembl_gene", by.y="ensembl_gene_id", all.x=TRUE)
# 结果：cpo_symbol -> human_symbol -> human_entrez
orth <- orth[, c("external_gene_name", "hsapiens_homolog_associated_gene_name", "hgnc_symbol", "entrezgene_id")]
colnames(orth)[1] <- "cpo_symbol"
head(orth)
colnames(gene_entrez) <- c("cpo_symbol", "hsa_name","hsa_symbol", "ENTREZID")
gene_entrez2 <- na.omit(orth)
colnames(gene_entrez2) <- c("cpo_symbol", "hsa_name","hsa_symbol", "ENTREZID")
GO <- enrichGO(gene = gene_entrez2$ENTREZID,
OrgDb = org.Hs.eg.db,
keyType ="ENTREZID",
ont ="ALL",            # "BP","MF"，"CC"或"ALL"
pAdjustMethod ="BH",
pvalueCutoff =0.05,
qvalueCutoff =0.05,readable = T)
GO_res <- GO@result
View(GO_res)
GO <- enrichGO(gene = gene_entrez2$ENTREZID,
OrgDb = org.Hs.eg.db,
keyType ="ENTREZID",
ont ="ALL",            # "BP","MF"，"CC"或"ALL"
pAdjustMethod ="BH",
pvalueCutoff =0.5,
qvalueCutoff =0.5,readable = T)
View(GO_res)
GO_res <- GO@result
GO <- enrichGO(gene = gene_entrez2$ENTREZID,
OrgDb = org.Hs.eg.db,
keyType ="ENTREZID",
ont ="ALL",            # "BP","MF"，"CC"或"ALL"
pAdjustMethod ="BH",
pvalueCutoff =1,
qvalueCutoff =1,readable = T)
GO_res <- GO@result
View(res1)
DEG = na.omit(res1)
logFC_cutoff <- 1
type1 = (DEG$padj < 0.05)&(DEG$log2FoldChange < -logFC_cutoff)
type2 = (DEG$padj < 0.05)&(DEG$log2FoldChange > logFC_cutoff)
DEG$change = ifelse (type1, "DOWN", ifelse (type2, "UP", "NOT"))
write.table(DEG, file='DEG2.txt',sep = "\t",row.names = T,col.names = NA, quote = F)
table(DEG$change)
diff <- rownames (DEG) [DEG$change!='NOT']
cpo_map <- getBM(
attributes = c("external_gene_name", "ensembl_gene_id"),
filters    = "external_gene_name",
values     = diff,
mart       = mart_cpo
)
attrs_cpo <- listAttributes(mart_cpo)$name
grep("hsapiens|ortholog", attrs_cpo, value=TRUE)[1:30]
orth1 <- getBM(
attributes = c(
"ensembl_gene_id",
"hsapiens_homolog_ensembl_gene",              # 关键：human ortholog Ensembl gene
"hsapiens_homolog_associated_gene_name"      # human symbol（可选））
),
filters = "ensembl_gene_id",
values  = unique(cpo_map$ensembl_gene_id),
mart    = mart_cpo
)
hsa_entrez <- getBM(
attributes = c("ensembl_gene_id", "entrezgene_id", "hgnc_symbol"),
filters    = "ensembl_gene_id",
values     = unique(orth1$hsapiens_homolog_ensembl_gene),
mart       = mart_hsa
)
# 合并
orth <- merge(orth1, cpo_map, by="ensembl_gene_id", all.x=TRUE)
orth <- merge(orth, hsa_entrez, by.x="hsapiens_homolog_ensembl_gene", by.y="ensembl_gene_id", all.x=TRUE)
# 结果：cpo_symbol -> human_symbol -> human_entrez
orth <- orth[, c("external_gene_name", "hsapiens_homolog_associated_gene_name", "hgnc_symbol", "entrezgene_id")]
colnames(orth)[1] <- "cpo_symbol"
head(orth)
gene_entrez2 <- na.omit(orth)
colnames(gene_entrez2) <- c("cpo_symbol", "hsa_name","hsa_symbol", "ENTREZID")
View(gene_entrez2)
GO <- enrichGO(gene = gene_entrez2$ENTREZID,
OrgDb = org.Hs.eg.db,
keyType ="ENTREZID",
ont ="ALL",            # "BP","MF"，"CC"或"ALL"
pAdjustMethod ="BH",
pvalueCutoff =0.05,
qvalueCutoff =0.05,readable = T)
GO_res <- GO@result
barplot(GO, showCategory = 5,,split="ONTOLOGY") +
facet_grid(ONTOLOGY~., scale='free')
barplot(GO, showCategory = 10,,split="ONTOLOGY") +
facet_grid(ONTOLOGY~., scale='free')
barplot(GO, showCategory = 20)
dotplot(GO, showCategory = 20)
terms_keep <- c(
"mitochondrion organization",
"mitochondrial transport",
"mitochondrial protein-containing complex"
)
barplot(GO, showCategory = terms_keep, split = "ONTOLOGY") +
facet_grid(ONTOLOGY ~ ., scales = "free")
GO <- enrichGO(gene = gene_entrez2$ENTREZID,
OrgDb = org.Hs.eg.db,
keyType ="ENTREZID",
ont ="ALL",            # "BP","MF"，"CC"或"ALL"
pAdjustMethod ="BH",
pvalueCutoff =0.1,
qvalueCutoff =0.2,readable = T)
GO_res <- GO@result
write.table(GO_res, file="GO_res.txt",sep="\t",quote=F,row.names = F)
terms_keep <- GO_res$Description[ grep("mito", GO_res$Description, ignore.case = TRUE) ]
barplot(GO, showCategory = terms_keep, split = "ONTOLOGY") +
facet_grid(ONTOLOGY ~ ., scales = "free")
barplot(GO, showCategory = terms_keep, split = "ONTOLOGY")
barplot(GO, showCategory = terms_keep, split = "ONTOLOGY") +
facet_grid(ONTOLOGY ~ ., scales = "free")
KEGG <- enrichKEGG(gene = gene_entrez2$ENTREZID,
organism='hsa', #小鼠为'mmu'
pvalueCutoff = 0.5,
qvalueCutoff = 0.5)
KEGG <- setReadable(KEGG, OrgDb = org.Mm.eg.db, keyType = "ENTREZID")
KEGG <- setReadable(KEGG, OrgDb = org.Hs.eg.db, keyType = "ENTREZID")
KEGG_res <- KEGG@result
write.table(KEGG_res, file="KEGG_res.txt",sep="\t",quote=F,row.names = F)
View(KEGG_res)
barplot(KEGG,showCategory = 20)
dotplot(KEGG, showCategory = 20)
#简单作图
KEGG_res1 <- KEGG_res[KEGG_res$category != "	Human Diseases", ]
View(KEGG_res1)
#简单作图
KEGG_res1 <- KEGG_res[KEGG_res$category != "Human Diseases", ]
barplot(KEGG_res1,showCategory = 20)
View(KEGG_res1)
KEGG_res1 <- as.matrix(KEGG_res1)
barplot(KEGG_res1,showCategory = 20)
dotplot(KEGG, showCategory = 20)
dotplot(KEGG_res1, showCategory = 20)
View(KEGG_res)
View(KEGG)
kdf <- as.data.frame(KEGG)
ids <- kdf$ID[kdf$type != "Human Diseases"]
dotplot(KEGG, showCategory = ids)
#简单作图
kdf <- as.data.frame(KEGG)
ids <- kdf$ID[kdf$type != "Human Diseases"]
ids <- kdf$ID[kdf$category != "Human Diseases"]
dotplot(KEGG, showCategory = 20)
KEGG <- enrichKEGG(gene = gene_entrez2$ENTREZID,
organism='hsa', #小鼠为'mmu'
pvalueCutoff = 0.1,
qvalueCutoff = 0.2)
KEGG <- setReadable(KEGG, OrgDb = org.Hs.eg.db, keyType = "ENTREZID")
KEGG_res <- KEGG@result
write.table(KEGG_res, file="KEGG_res.txt",sep="\t",quote=F,row.names = F)
kdf <- as.data.frame(KEGG)
ids <- kdf$ID[kdf$category != "Human Diseases"]
dotplot(KEGG, showCategory = ids)
KEGG <- enrichKEGG(gene = gene_entrez2$ENTREZID,
organism='hsa', #小鼠为'mmu'
pvalueCutoff = 0.1,
qvalueCutoff = 0.2)
View(KEGG)
KEGG <- setReadable(KEGG, OrgDb = org.Hs.eg.db, keyType = "ENTREZID")
KEGG_res <- KEGG@result
write.table(KEGG_res, file="KEGG_res.txt",sep="\t",quote=F,row.names = F)
#简单作图
kdf <- as.data.frame(KEGG)
View(kdf)
KEGG <- enrichKEGG(gene = gene_entrez2$ENTREZID,
organism='hsa', #小鼠为'mmu'
pvalueCutoff = 0.2,
qvalueCutoff = 0.2)
KEGG <- enrichKEGG(gene = gene_entrez2$ENTREZID,
organism='hsa', #小鼠为'mmu'
pvalueCutoff = 0.2,
qvalueCutoff = 0.2)
KEGG <- setReadable(KEGG, OrgDb = org.Hs.eg.db, keyType = "ENTREZID")
KEGG_res <- KEGG@result
write.table(KEGG_res, file="KEGG_res.txt",sep="\t",quote=F,row.names = F)
View(KEGG_res)
#简单作图
kdf <- as.data.frame(KEGG)
kdf <- as.data.frame(KEGG)
kdf <- kdf[kdf$category != "Human Diseases"]
View(kdf)
kdf$category
[kdf$category != "Human Diseases"]
kdf$category != "Human Diseases"
kdf <- kdf[kdf$category != "Human Diseases"]
kdf <- kdf(kdf$category != "Human Diseases")
kdf <- kdf[kdf$category != "Human Diseases",]
View(kdf)
View(KEGG)
ids <- kdf&ID[kdf$category != "Human Diseases"]
ids <- kdf$ID[kdf$category != "Human Diseases"]
dotplot(KEGG, showCategory = ids)
dotplot(KEGG, showCategory = 20)
ids <- kdf$ID[kdf$category != "Human Diseases"]
dotplot(KEGG, showCategory = ids)
ids
